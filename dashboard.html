<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <nav>
    <a href="profile.html">Profile</a>
    <a href="/logout">Logout</a>
  </nav>

  <!-- fixed header -->
  <div class="header" id="header">
    <h1>Welcome Back!</h1>
    <p>Your personalized fitness & diet plan is ready ğŸš€</p>
  </div>

  <div class="main-layout">
    <div class="content">
      <h2>Hereâ€™s Your Plan</h2>
      <h3>Recommended Food</h3>
      <div class="items" id="food"></div>
      <h3>Recommended Workouts</h3>
      <div class="items" id="workout"></div>
    </div>
    <div class="profile-box" id="profileBox"></div>
  </div>

  <!-- Chat button -->
 <div id="chatButton" class="chat-button">ğŸ’¬</div>

  <!-- Chatbot -->
  <div class="chatbot" id="chatbot">
    <div class="chat-header">
      ğŸ’¬ Fitness Assistant
      <span id="closeChat">âœ–</span>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="Type your message...">
      <button id="sendBtn">Send</button>
    </div>
  </div>
<script>
function calculateBMI(weight, height) {
  height = height / 100;
  return (weight / (height * height)).toFixed(1);
}

function getPlan(bmi, goal) {
  let category;
  if (bmi < 18.5) category = "underweight";
  else if (bmi >= 18.5 && bmi < 25) category = "normal";
  else category = "overweight";
  let plan;
  if (category === "underweight") {
    plan = goal === "muscle_gain" ? {
      food: [
        { name: "Eggs", img: "images/eggs.jpeg" },
        { name: "Chicken", img: "images/chicken.jpeg" },
        { name: "Milk", img: "images/milk.jpeg" }
      ],
      workout: [
        { name: "Weight Lifting", img: "images/weights.jpeg" },
        { name: "Push-ups", img: "images/pushups.jpeg" },
        { name: "Squats", img: "images/squats.jpeg" }
      ]
    } : {
      food: [
        { name: "Rice", img: "images/rice.jpeg" },
        { name: "Bread", img: "images/bread.jpeg" },
        { name: "Bananas", img: "images/bananas.jpeg" }
      ],
      workout: [
        { name: "Yoga", img: "images/yoga.jpeg" },
        { name: "Stretching", img: "images/streching.jpeg" },
        { name: "Walking", img: "images/waliking.jpeg" }
      ]
    };
  } else if (category === "normal") {
    plan = goal === "muscle_gain" ? {
      food: [
        { name: "Paneer", img: "images/paneer.jpeg" },
        { name: "Lean Meat", img: "images/chicken.jpeg" },
        { name: "Nuts", img: "images/nuts.jpeg" }
      ],
      workout: [
        { name: "Bench Press", img: "images/benchpress.jpeg" },
        { name: "Deadlifts", img: "images/deadlifts.jpeg" },
        { name: "Pull-ups", img: "images/pullups.jpeg" }
      ]
    } : {
      food: [
        { name: "Salad", img: "images/salad.jpeg" },
        { name: "Grilled Fish", img: "images/fish.jpeg" },
        { name: "Fruits", img: "images/fruits.jpeg" }
      ],
      workout: [
        { name: "Jogging", img: "images/waliking.jpeg" },
        { name: "Cycling", img: "images/cycling.jpeg" },
        { name: "Plank", img: "images/plank.jpeg" }
      ]
    };
  } else {
    plan = goal === "muscle_gain" ? {
      food: [
        { name: "High Protein Salad", img: "images/protien salad.jpeg" },
        { name: "Chicken Breast", img: "images/chicken.jpeg" },
        { name: "Boiled Eggs", img: "images/eggs.jpeg" }
      ],
      workout: [
        { name: "Strength Training", img: "images/weights.jpeg" },
        { name: "Resistance Bands", img: "images/babd.jpeg" },
        { name: "Swimming", img: "images/swimming.jpeg" }
      ]
    } : {
      food: [
        { name: "Vegetables", img: "images/healthy veg.jpg" },
        { name: "Oats", img: "images/oats.jpeg" },
        { name: "Soup", img: "images/soup.jpeg" }
      ],
      workout: [
        { name: "Cardio", img: "images/waliking.jpeg" },
        { name: "Skipping", img: "images/skipping.jpeg" },
        { name: "HIIT", img: "images/hiit.jpeg" }
      ]
    };
  }
  return plan;
}

function renderItems(containerId, items) {
  const container = document.getElementById(containerId);
  container.innerHTML = items.map(i => `
    <div>
      <img src="${i.img}" alt="${i.name}">
      <p>${i.name}</p>
    </div>
  `).join("");
}

function loadProfile() {
  fetch('/api/profile')
    .then(res => res.json())
    .then(user => {
      const bmi = calculateBMI(user.weight, user.height);
      const plan = getPlan(bmi, user.goal);
      renderItems("food", plan.food);
      renderItems("workout", plan.workout);
      document.getElementById("profileBox").innerHTML = `
        <img src="${user.profile_pic || 'images/default.png'}" alt="Profile">
        <h3>${user.name}</h3>
        <p>Age: ${user.age}</p>
        <p>Gender: ${user.gender}</p>
        <p>Height: ${user.height} cm</p>
        <p>Weight: ${user.weight} kg</p>
        <p>Goal: ${user.goal}</p>
        <p><strong>BMI: ${bmi}</strong></p>
      `;
      document.getElementById("header").innerHTML = `
        <h1>Welcome Back, ${user.name}!</h1>
        <p>Stay consistent ğŸ’ª â€” your personalized fitness & diet plan is ready ğŸš€</p>
      `;
    });
}
loadProfile();

  // Toggle chat window
document.addEventListener("DOMContentLoaded", () => {
  const chatButton = document.getElementById("chatButton");
  const chatbot = document.getElementById("chatbot");
  const closeChat = document.getElementById("closeChat");
  const chatMessages = document.getElementById("chatMessages");
  const chatInput = document.getElementById("chatInput");
  const sendBtn = document.getElementById("sendBtn");

  // Toggle chat open
  chatButton.onclick = () => {
    chatbot.style.display = "flex";
    chatInput.focus();
  };

  // Close chat
  closeChat.onclick = () => {
    chatbot.style.display = "none";
  };

  // Send message
  async function sendMessage() {
    const message = chatInput.value.trim();
    if (!message) return;

    // Add user message
    chatMessages.innerHTML += `<div class="user-msg">${message}</div>`;
    chatInput.value = "";

    try {
      const res = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt: message })
      });
      const data = await res.json();

      chatMessages.innerHTML += `<div class="bot-msg">${data.code}</div>`;
      chatMessages.scrollTop = chatMessages.scrollHeight;
    } catch (err) {
      console.error(err);
      chatMessages.innerHTML += `<div class="bot-msg">âš ï¸ Error connecting</div>`;
    }
  }

  // Button click
  sendBtn.onclick = sendMessage;

  // Enter key
  chatInput.addEventListener("keypress", e => {
    if (e.key === "Enter") {
      e.preventDefault();
      sendMessage();
    }
  });
});

</script>

</body>
</html>
